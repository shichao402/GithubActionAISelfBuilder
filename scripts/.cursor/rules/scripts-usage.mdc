---
alwaysApply: true
---

# Scripts 使用规则 - 共享给目标项目

## 概述

本目录包含可共享给其他项目使用的脚本工具。当本项目作为子项目（Git Submodule）被其他项目使用时，这些脚本可以帮助父项目进行 GitHub Actions 的调试和管理。

## 共享脚本分类

### 1. Git 推送脚本（共享）

**位置**: `scripts/push-git.ts`, `scripts/push-git.ps1`, `scripts/push-git.sh`

**用途**: 一键推送 Git 更改，方便持续测试 GitHub Actions

**使用方式**:
```bash
# 在父项目中使用
npm run push [提交信息]
# 或
ts-node GithubActionAISelfBuilder/scripts/push-git.ts [提交信息]
```

### 2. AI 调试工作流脚本（共享）

**位置**: `scripts/test/ai-debug-workflow.ts`

**用途**: AI 自我调试 GitHub Actions 工作流，自动触发、监控、收集日志并分析错误

**使用方式**:
```bash
# 在父项目中使用
ts-node GithubActionAISelfBuilder/scripts/test/ai-debug-workflow.ts <workflow-file> [ref]
# 或创建 npm 脚本
npm run ai-debug -- .github/workflows/build.yml main
```

**功能**:
- ✅ 自动触发 GitHub Action 工作流
- ✅ 实时监控工作流执行状态
- ✅ 失败时自动收集详细错误日志
- ✅ 分析日志并提供修正建议

**使用场景**:
- 父项目的 GitHub Action 工作流失败时
- 需要调试和修正工作流配置时
- 需要验证工作流修复是否成功时

### 3. 测试脚本（仅本项目使用）

**位置**: `scripts/test/test-flutter-pipeline.ts`

**用途**: 仅用于测试本项目的 Flutter Pipeline，不作为共享工具

## 在父项目中使用

### 方式 1: 作为 Git Submodule

```bash
# 在父项目中添加子模块
git submodule add https://github.com/your-org/GithubActionAISelfBuilder.git

# 使用 AI 调试脚本
ts-node GithubActionAISelfBuilder/scripts/test/ai-debug-workflow.ts .github/workflows/build.yml main
```

### 方式 2: 创建 npm 脚本包装

在父项目的 `package.json` 中添加：

```json
{
  "scripts": {
    "ai-debug": "ts-node GithubActionAISelfBuilder/scripts/test/ai-debug-workflow.ts"
  }
}
```

然后使用：
```bash
npm run ai-debug -- .github/workflows/build.yml main
```

### 方式 3: 直接复制脚本

如果不想使用子模块，可以直接复制需要的脚本到父项目的 `scripts/` 目录。

## AI 助手行为规则

当父项目需要调试 GitHub Action 工作流时：

1. **必须使用本项目提供的 AI 调试脚本**
   - 使用 `scripts/test/ai-debug-workflow.ts`
   - 禁止手动分析或猜测错误原因

2. **遵循调试流程**:
   - 触发工作流
   - 监控执行状态
   - 收集失败日志
   - 分析错误并修正
   - 重新验证

3. **禁止的操作**:
   - ❌ 不收集日志就猜测错误原因
   - ❌ 手动查看 GitHub 网页界面分析错误（除非无法使用脚本）
   - ❌ 不验证修正就推送代码

## 脚本依赖

使用这些脚本需要：

1. **Node.js 18+**: 确保已安装 Node.js
2. **TypeScript**: 需要 `ts-node` 或编译后的 JavaScript
3. **GitHub CLI**: 需要安装并登录 GitHub CLI (`gh auth login`)
4. **项目依赖**: 如果使用 TypeScript 脚本，需要安装项目依赖

## 示例：完整的调试流程

```bash
# 1. 触发并监控工作流
npm run ai-debug -- .github/workflows/build.yml main

# 2. 如果失败，脚本会自动：
#    - 收集错误日志
#    - 分析错误原因
#    - 提供修正建议

# 3. 根据建议修正工作流或代码

# 4. 重新触发验证
npm run ai-debug -- .github/workflows/build.yml main
```

## 注意事项

1. **路径问题**: 如果作为子模块使用，注意脚本中的相对路径可能需要调整
2. **权限问题**: 确保 GitHub CLI 有足够的权限访问仓库
3. **环境变量**: 某些脚本可能需要特定的环境变量
4. **跨平台**: TypeScript 脚本跨平台，Shell/PowerShell 脚本需要对应平台

## 更新日志

- 2025-11-30: 初始版本，包含 Git 推送和 AI 调试脚本规则
