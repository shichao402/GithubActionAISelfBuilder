---
alwaysApply: true
---

# å•å…ƒæµ‹è¯•æ ¸å¿ƒè§„åˆ™ï¼ˆéžå…±äº«ï¼‰

## âš ï¸ é‡è¦è¯´æ˜Ž

**æ­¤è§„åˆ™æ–‡ä»¶ä½äºŽ `ProjectOnly/` ç›®å½•ï¼Œä»…é€‚ç”¨äºŽæœ¬é¡¹ç›®å¼€å‘ã€‚**

**å…³é”®ç‰¹æ€§**:
- âœ… æœ¬é¡¹ç›®å¼€å‘æ—¶ï¼šæ­¤è§„åˆ™ä¼šè¢«åº”ç”¨
- âŒ æ³¨å…¥åˆ°çˆ¶é¡¹ç›®æ—¶ï¼š`ProjectOnly/` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬æ­¤è§„åˆ™ï¼‰**ä¼šè¢«åˆ é™¤**
- ðŸš« **ç¦æ­¢åœ¨å…±äº«è§„åˆ™ä¸­å¼•ç”¨ ProjectOnly çš„å†…å®¹**ï¼Œé¿å…çˆ¶é¡¹ç›®æ‰¾ä¸åˆ°å¼•ç”¨

**è®¾è®¡ç›®çš„**:
- éš”ç¦»é¡¹ç›®ç‰¹å®šçš„æµ‹è¯•è§„èŒƒï¼Œä¸å½±å“çˆ¶é¡¹ç›®
- ç¡®ä¿å…±äº«è§„åˆ™æ–‡ä»¶ç‹¬ç«‹å®Œæ•´ï¼Œä¸ä¾èµ– ProjectOnly å†…å®¹

## ðŸš¨ æ ¸å¿ƒåŽŸåˆ™

**å•å…ƒæµ‹è¯•å¿…é¡»æµ‹è¯•è¡Œä¸ºï¼Œè€Œéžå®žçŽ°ç»†èŠ‚ã€‚é¿å…æ‹¿ç€å®žçŽ°å¼ºè¡ŒæŽ¨æ–­å•æµ‹ç»“æžœï¼Œè¿™æ ·å•æµ‹å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚**

## âœ… å¿…é¡»éµå®ˆ

1. **æµ‹è¯•å…¬å…±æŽ¥å£**ï¼šåªæµ‹è¯• `execute()` ç­‰å…¬å…±æ–¹æ³•ï¼Œä¸æµ‹è¯• protected/private æ–¹æ³•
2. **éªŒè¯è¡Œä¸ºç»“æžœ**ï¼šéªŒè¯ `result.success`ã€`result.exitCode`ã€`result.data` ç­‰è¾“å‡º
3. **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæµ‹è¯•å®Œæ•´æµç¨‹ï¼Œä¸æµ‹è¯•å†…éƒ¨æ–¹æ³•
4. **è¦†ç›–è¾¹ç•Œæƒ…å†µ**ï¼šæµ‹è¯•æˆåŠŸã€å¤±è´¥ã€é”™è¯¯ã€æ— æ•ˆè¾“å…¥ç­‰åœºæ™¯

## âŒ ä¸¥æ ¼ç¦æ­¢

1. **ç¦æ­¢æµ‹è¯• protected/private æ–¹æ³•**
   ```typescript
   // âŒ é”™è¯¯
   await (pipeline as any).setupEnvironment();
   ```

2. **ç¦æ­¢éªŒè¯å®žçŽ°ç»†èŠ‚**
   ```typescript
   // âŒ é”™è¯¯
   expect(mockExec).toHaveBeenCalled();
   ```

3. **ç¦æ­¢æ ¹æ®å®žçŽ°æŽ¨æ–­æµ‹è¯•ç»“æžœ**

## ðŸ“‹ æµ‹è¯•ç»“æž„æ¨¡æ¿

```typescript
describe('PipelineName', () => {
  describe('execute() - å®Œæ•´æµç¨‹', () => {
    test('åº”è¯¥æˆåŠŸæ‰§è¡Œå®Œæ•´æµç¨‹', async () => {
      // 1. è®¾ç½®è¾“å…¥
      process.env.INPUT_XXX = 'value';
      
      // 2. æ‰§è¡Œ
      const pipeline = new PipelineName();
      const result = await pipeline.execute();
      
      // 3. éªŒè¯è¾“å‡º
      expect(result.success).toBe(true);
      expect(result.exitCode).toBe(0);
    });

    test('åº”è¯¥åœ¨å¤±è´¥æ—¶è¿”å›žå¤±è´¥', async () => {
      // è®¾ç½®å¤±è´¥åœºæ™¯
      const result = await pipeline.execute();
      expect(result.success).toBe(false);
      expect(result.exitCode).toBe(1);
    });
  });
});
```

## ðŸŽ¯ è¦†ç›–çŽ‡ç›®æ ‡

- è¯­å¥è¦†ç›–çŽ‡ï¼š80%+
- åˆ†æ”¯è¦†ç›–çŽ‡ï¼š70%+
- å‡½æ•°è¦†ç›–çŽ‡ï¼š75%+
- è¡Œè¦†ç›–çŽ‡ï¼š80%+

## ðŸ“ Mock è§„èŒƒ

- åª Mock å¤–éƒ¨ä¾èµ–ï¼ˆfsã€child_processã€@actions/coreï¼‰
- åœ¨ `jest.mock()` å†…éƒ¨å®šä¹‰ mock å‡½æ•°
- åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ `require()` èŽ·å– mock å¼•ç”¨

```typescript
jest.mock('fs', () => {
  const mockExistsSync = jest.fn(() => true);
  return { existsSync: mockExistsSync };
});

// åœ¨æµ‹è¯•ä¸­
const fs = require('fs');
fs.existsSync.mockReturnValue(true);
```
