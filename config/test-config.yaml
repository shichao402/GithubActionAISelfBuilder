# 测试流水线配置文件

pipeline:
  name: Test Pipeline
  description: 项目测试和代码覆盖率检查流水线
  
  # 输入参数定义
  inputs:
    test-type:
      default: all
      description: 测试类型（all/unit/integration）
      required: false
    coverage-threshold:
      default: "80"
      description: 代码覆盖率阈值（百分比）
      required: false
    run-unit-tests:
      default: "true"
      description: 是否运行单元测试
      required: false
    run-integration-tests:
      default: "false"
      description: 是否运行集成测试
      required: false
    upload-reports:
      default: "true"
      description: 是否上传测试报告
      required: false
  
  # 环境变量
  env:
    PYTHONUNBUFFERED: "1"
    PYTEST_CURRENT_TEST: "1"
    CI: "true"
  
  # 自定义步骤（在运行脚本之前执行）
  steps:
    - name: Check test dependencies
      run: |
        python -c "import pytest; print('pytest version:', pytest.__version__)" || echo "pytest not installed"
  
  # 触发条件
  triggers:
    push:
      branches:
        - main
        - develop
    pull_request:
      branches:
        - main
        - develop
    workflow_dispatch:
      inputs:
        test-type:
          description: '测试类型'
          required: false
          default: 'all'
        coverage-threshold:
          description: '覆盖率阈值'
          required: false
          default: '80'
  
  # 依赖的其他流水线（可选）
  # dependencies: []

