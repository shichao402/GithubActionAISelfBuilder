---
alwaysApply: true
---

# GitHub Actions å·¥ä½œæµè§„åˆ™

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

AI åŠ©æ‰‹åœ¨å¤„ç† GitHub Actions æ—¶åº”éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **ç®€æ´ä¼˜å…ˆ**: ä½¿ç”¨ YAML æ¨¡æ¿ï¼Œé¿å…è¿‡åº¦æŠ½è±¡
2. **æµ‹è¯•é©±åŠ¨**: ä¿®æ”¹åå¿…é¡»éªŒè¯ï¼Œä½¿ç”¨å·¥å…·è‡ªåŠ¨åŒ–è°ƒè¯•
3. **æœ¬åœ°ä¸€è‡´**: æœ¬åœ°æ„å»ºè„šæœ¬åº”ä¸ CI æµç¨‹ä¿æŒä¸€è‡´
4. **æ–‡æ¡£åŒæ­¥**: ä»£ç å˜æ›´æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£

## ğŸ“‹ å·¥ä½œæµæ–‡ä»¶ç®¡ç†

### å·¥ä½œæµæ–‡ä»¶ä½ç½®

- æ‰€æœ‰ GitHub Actions å·¥ä½œæµæ–‡ä»¶æ”¾åœ¨ `.github/workflows/` ç›®å½•
- æ¨¡æ¿æ–‡ä»¶æ”¾åœ¨ `.github/templates/` ç›®å½•ï¼ˆå¦‚æœæœ‰ï¼‰
- ä½¿ç”¨æè¿°æ€§æ–‡ä»¶åï¼š`build-nodejs.yml`, `test-python.yml`, `release.yml`

### å·¥ä½œæµå‘½åè§„èŒƒ

```yaml
name: Build and Test  # æ¸…æ™°æè¿°å·¥ä½œæµç”¨é€”

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  build:
    name: Build on ${{ matrix.os }}  # æ¸…æ™°çš„ä»»åŠ¡å
    runs-on: ${{ matrix.os }}
    # ...
```

## ğŸ”§ æœ€ä½³å®è·µ

### 1. è§¦å‘æ¡ä»¶

```yaml
# âœ… æ¨èï¼šæ˜ç¡®æŒ‡å®šåˆ†æ”¯å’Œè·¯å¾„
on:
  push:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'package.json'
  pull_request:
    branches: [main]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      debug_enabled:
        description: 'Enable debug mode'
        required: false
        default: 'false'

# âŒ é¿å…ï¼šè¿‡äºå®½æ³›çš„è§¦å‘æ¡ä»¶
on: [push, pull_request]  # ä¸æ˜ç¡®ï¼Œå¯èƒ½è§¦å‘è¿‡å¤š
```

### 2. ç¯å¢ƒå˜é‡å’Œå¯†é’¥

```yaml
env:
  NODE_VERSION: '18'  # å…¨å±€ç¯å¢ƒå˜é‡
  
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      BUILD_ENV: production  # ä»»åŠ¡çº§ç¯å¢ƒå˜é‡
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Use secrets safely
        env:
          # âœ… æ­£ç¡®ï¼šåœ¨æ­¥éª¤çº§åˆ«ä½¿ç”¨å¯†é’¥
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # ä½¿ç”¨ $TOKENï¼Œä¸è¦åœ¨æ—¥å¿—ä¸­æ‰“å°
          echo "Token is set"
```

**é‡è¦è§„åˆ™**ï¼š
- âœ… ä½¿ç”¨ `${{ secrets.GITHUB_TOKEN }}` è®¿é—®ä»“åº“ï¼ˆé»˜è®¤æä¾›ï¼‰
- âœ… æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ GitHub Secrets
- âŒ æ°¸è¿œä¸è¦åœ¨æ—¥å¿—ä¸­æ‰“å°å¯†é’¥
- âŒ ä¸è¦ç¡¬ç¼–ç å¯†ç æˆ– Token

### 3. ç¼“å­˜ç­–ç•¥

```yaml
steps:
  - name: Setup Node.js
    uses: actions/setup-node@v4
    with:
      node-version: '18'
      cache: 'npm'  # âœ… è‡ªåŠ¨ç¼“å­˜ npm ä¾èµ–
  
  # æˆ–æ‰‹åŠ¨ç¼“å­˜
  - name: Cache dependencies
    uses: actions/cache@v3
    with:
      path: |
        ~/.npm
        node_modules
      key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
      restore-keys: |
        ${{ runner.os }}-npm-
```

### 4. é”™è¯¯å¤„ç†

```yaml
steps:
  - name: Run tests
    id: tests
    continue-on-error: true  # å…è®¸å¤±è´¥ä½†ç»§ç»­æ‰§è¡Œ
    run: npm test
  
  - name: Report test results
    if: always()  # æ€»æ˜¯æ‰§è¡Œï¼Œå³ä½¿å‰é¢æ­¥éª¤å¤±è´¥
    run: echo "Tests completed"
  
  - name: Fail if tests failed
    if: steps.tests.outcome == 'failure'
    run: exit 1
```

### 5. çŸ©é˜µæ„å»º

```yaml
jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node: [16, 18, 20]
        exclude:
          - os: macos-latest
            node: 16  # æ’é™¤ç‰¹å®šç»„åˆ
      fail-fast: false  # ä¸å› å•ä¸ªå¤±è´¥åœæ­¢æ‰€æœ‰ä»»åŠ¡
    
    runs-on: ${{ matrix.os }}
    steps:
      - name: Setup Node.js ${{ matrix.node }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node }}
```

## ğŸš« ç¦æ­¢çš„æ“ä½œ

### 1. ç¦æ­¢æ‰‹åŠ¨è¿è¡Œå¤æ‚å‘½ä»¤

AI åŠ©æ‰‹**ä¸¥æ ¼ç¦æ­¢**æ‰‹åŠ¨æ‹¼æ¥å¤æ‚çš„ GitHub CLI å‘½ä»¤ï¼š

```bash
# âŒ ç¦æ­¢ï¼šæ‰‹åŠ¨è¿è¡Œ gh workflow å‘½ä»¤
gh workflow run build.yml --ref main -f version=1.0.0

# âŒ ç¦æ­¢ï¼šå¤æ‚çš„å‘½ä»¤æ‹¼æ¥
gh workflow run build.yml && sleep 10 && node -e "console.log('waiting')"

# âœ… æ­£ç¡®ï¼šä½¿ç”¨é¡¹ç›®æä¾›çš„è°ƒè¯•è„šæœ¬
npm run ai-debug -- .github/workflows/build.yml main
```

### 2. ç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹ç”Ÿæˆçš„å·¥ä½œæµ

å¦‚æœå·¥ä½œæµæ˜¯ä»æ¨¡æ¿æˆ–å·¥å…·ç”Ÿæˆçš„ï¼Œ**ä¸¥æ ¼ç¦æ­¢**ç›´æ¥ä¿®æ”¹ YAML æ–‡ä»¶ï¼š

```bash
# âŒ ç¦æ­¢ï¼šç›´æ¥ç¼–è¾‘ç”Ÿæˆçš„ workflow
vim .github/workflows/build.yml

# âœ… æ­£ç¡®ï¼šä¿®æ”¹æ¨¡æ¿åé‡æ–°ç”Ÿæˆ
vim .github/templates/build-template.yml
npm run generate-workflow
```

## ğŸ” è°ƒè¯•å·¥ä½œæµ

### ä½¿ç”¨å·¥å…·è„šæœ¬è°ƒè¯•

AI åŠ©æ‰‹åœ¨è°ƒè¯• GitHub Actions æ—¶**å¿…é¡»ä½¿ç”¨**é¡¹ç›®æä¾›çš„è°ƒè¯•å·¥å…·ï¼š

```bash
# âœ… æ­£ç¡®ï¼šä½¿ç”¨ AI è°ƒè¯•è„šæœ¬
npm run ai-debug -- .github/workflows/build.yml main

# å¸¦å‚æ•°çš„è°ƒè¯•
npm run ai-debug -- .github/workflows/release.yml main -f version=1.0.0

# âœ… æ­£ç¡®ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬
npm run test-pipeline -- --workflow build.yml --trigger --watch
```

**è°ƒè¯•æµç¨‹**ï¼š
1. ä¿®æ”¹å·¥ä½œæµæˆ–ä»£ç 
2. **å…ˆæ¨é€ä»£ç åˆ°è¿œç¨‹ä»“åº“**ï¼ˆå¿…é¡»ï¼ï¼‰
3. ä½¿ç”¨è°ƒè¯•è„šæœ¬è§¦å‘å¹¶ç›‘æ§
4. è„šæœ¬è‡ªåŠ¨æ”¶é›†é”™è¯¯æ—¥å¿—
5. æ ¹æ®å»ºè®®ä¿®æ­£ä»£ç 
6. é‡å¤ 1-5 ç›´åˆ°æˆåŠŸ

**é‡è¦**ï¼šåœ¨çº¿ workflow æµ‹è¯•éœ€è¦ä»£ç åœ¨è¿œç¨‹ä»“åº“ä¸­ï¼Œ**å¿…é¡»å…ˆæ¨é€ä»£ç **å†è§¦å‘æµ‹è¯•ã€‚

### å¯ç”¨è°ƒè¯•æ—¥å¿—

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Enable debug logging
        if: runner.debug == '1'
        run: echo "Debug mode enabled"
      
      - name: Run with debug
        run: |
          set -x  # å¯ç”¨ shell è°ƒè¯•è¾“å‡º
          npm run build
```

æ‰‹åŠ¨è§¦å‘æ—¶å¯ç”¨è°ƒè¯•ï¼š

```bash
# ä½¿ç”¨ workflow_dispatch çš„ debug input
gh workflow run build.yml -f debug_enabled=true
```

## ğŸ“¦ å¸¸ç”¨ Actions

### æ¨èçš„å®˜æ–¹ Actions

```yaml
# ä»£ç æ£€å‡º
- uses: actions/checkout@v4
  with:
    fetch-depth: 0  # è·å–å®Œæ•´å†å²ï¼ˆç”¨äºç‰ˆæœ¬æ ‡ç­¾ç­‰ï¼‰

# è®¾ç½® Node.js
- uses: actions/setup-node@v4
  with:
    node-version: '18'
    cache: 'npm'

# è®¾ç½® Python
- uses: actions/setup-python@v5
  with:
    python-version: '3.11'
    cache: 'pip'

# ä¸Šä¼ æ„å»ºäº§ç‰©
- uses: actions/upload-artifact@v4
  with:
    name: build-output
    path: dist/

# ä¸‹è½½æ„å»ºäº§ç‰©
- uses: actions/download-artifact@v4
  with:
    name: build-output
    path: dist/

# åˆ›å»º GitHub Release
- uses: softprops/action-gh-release@v1
  with:
    files: |
      dist/*.zip
      dist/*.tar.gz
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

## ğŸ” æƒé™ç®¡ç†

```yaml
# æœ€å°æƒé™åŸåˆ™
permissions:
  contents: read  # åªè¯»ä»£ç 
  issues: write   # å¯å†™ issues
  pull-requests: write  # å¯å†™ PR

# æˆ–è€…ä½¿ç”¨é»˜è®¤æƒé™
permissions: {}  # ä½¿ç”¨ä»“åº“é»˜è®¤æƒé™

# éœ€è¦å†™æƒé™æ—¶æ˜ç¡®å£°æ˜
permissions:
  contents: write  # ç”¨äºæ¨é€æ ‡ç­¾æˆ–å‘å¸ƒ
```

## ğŸ“ æ³¨é‡Šå’Œæ–‡æ¡£

```yaml
name: Build and Test

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # âœ… å¥½çš„æ³¨é‡Šï¼šè§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·åš
      # ä½¿ç”¨ Node.js 18 æ˜¯å› ä¸ºé¡¹ç›®ä¾èµ–éœ€è¦
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      # âŒ åçš„æ³¨é‡Šï¼šé‡å¤ä»£ç å†…å®¹
      # å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: npm install
```

## ğŸ¯ AI åŠ©æ‰‹è¡Œä¸ºè¦æ±‚

1. **ä½¿ç”¨æ¨¡æ¿**: ä¼˜å…ˆä» `.github/templates/` å¤åˆ¶å¹¶ä¿®æ”¹
2. **ä½¿ç”¨å·¥å…·**: è°ƒè¯•æ—¶å¿…é¡»ä½¿ç”¨é¡¹ç›®æä¾›çš„è„šæœ¬
3. **éªŒè¯ä¿®æ”¹**: æ¯æ¬¡ä¿®æ”¹åéƒ½è¦è§¦å‘æµ‹è¯•éªŒè¯
4. **å…ˆæ¨é€å†æµ‹**: åœ¨çº¿æµ‹è¯•å‰å¿…é¡»å…ˆæ¨é€ä»£ç åˆ°è¿œç¨‹ä»“åº“
5. **ä¿æŒç®€æ´**: é¿å…è¿‡åº¦å¤æ‚çš„å·¥ä½œæµé€»è¾‘
6. **æ–‡æ¡£åŒæ­¥**: ä¿®æ”¹å·¥ä½œæµæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£
